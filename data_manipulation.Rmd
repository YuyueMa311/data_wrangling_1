---
title: "data_manipulation"
output: github_document
---

```{r}
library(tidyverse)
```

Import dataframes:
```{r}
litters_df = 
    read_csv("./data_import_examples/FAS_litters.csv", na = c("NA", ".", ""))

litters_df = 
    janitor::clean_names(litters_df)

pups_df = 
    read_csv("./data_import_examples/FAS_pups.csv", na = c("NA", "."), skip = 3)

pups_df = 
    janitor::clean_names(pups_df)
```

## `select`

`select` selects variables from my dataframe.
```{r}
select(litters_df, group, litter_number, gd0_weight, pups_born_alive)
```

`select` select a specific range
```{r}
select(litters_df, group:gd_of_birth)
```

`select` select by removal
```{r}
select(litters_df, -pups_survive)
```

`select` to remove a ranges of variable together
```{r}
select(litters_df, -(group:gd_of_birth))
```

`select` by prefix (ie."gd"); also 'ends_with()', and 'contains()'
```{r}
select(litters_df, group, starts_with("gd"))
```

rearrange by selecting
```{r}
select(litters_df, starts_with("gd"), group, litter_number)
```

rearrange by selecting, keep everything as listed; 'relocate' works the same
```{r}
select(litters_df, litter_number, everything())

relocate(litters_df, litter_number)
```

rename by selecting
```{r}
rename(litters_df, GROUP = group, LiTtEr_NuMbEr = litter_number)
```

what if only select one variable...? 
```{r}
select(litters_df, group)

pull(litters_df, group)
```
same for 'pull' but remember to save it somewhere for later use

Learning Assessment Code:
```{r}
select(pups_df, litter_number, sex, pd_ears)
```


## 'Filter'

Use `filter()` to filter out rows. 

filter variables that satistify rules
```{r}
filter(litters_df, gd_of_birth == 20, pups_born_alive == 6)
```
look for more than 5 pups alive:
```{r}
filter(litters_df, pups_born_alive > 5)
filter(litters_df, pups_born_alive >= 5)
filter(litters_df, pups_born_alive <= 5)
```

look for non-matches: `!=` not equal to
```{r}
filter(litters_df, pups_born_alive !=6)
```

match to a set, keep specific group: Con7 and Con8
```{r}
filter(litters_df, group %in% c("Con7", "Con8"))
```

filter out missing rows with `drop_na()` in the whole dataset 
or just filter out missing rows under gd0_weight
```{r}
drop_na(litters_df)
drop_na(litters_df, gd0_weight)
```

Learning Assignment Code:
```{r}
filter(pups_df, sex == 1)
filter(pups_df, sex == 2, pd_walk < 11)
```


## `Mutate`

Use `mutate()` to create or modify variables: 
create wt_gain and make variable(group) lower case.
```{r}
mutate(litters_df,
  wt_gain = gd18_weight - gd0_weight,
  group = str_to_lower(group)
)
```


## `arrange`

`arrange()` arranges things, descending order by `desc()`
`head(...,10)` only show first 10 rows
```{r}
arrange(litters_df, group, pups_born_alive)
arrange(litters_df, group, desc(pups_born_alive))

head(arrange(litters_df, group, pups_born_alive), 10)
```


## PIPES

Bad way of managering your data manipulation process:
```{r}
litters_df_raw = 
    read_csv("./data_import_examples/FAS_litters.csv", na = c("NA", ".", ""))

litters_df_clean_names = janitor::clean_names(litters_df_raw)

litters_df_selected_cols = select(litters_df_clean_names, -pups_survive)
litters_df_with_vars = 
  mutate(
    litters_df_selected_cols, 
    wt_gain = gd18_weight - gd0_weight,
    group = str_to_lower(group))
litters_df_with_vars_without_missing = 
  drop_na(litters_df_with_vars, wt_gain)
litters_df_with_vars_without_missing
```


```{r}
litters_df_clean = 
  drop_na(
    mutate(
      select(
        janitor::clean_names(
          read_csv("./data_import_examples/FAS_litters.csv", na = c("NA", ".", ""))
          ), 
      -pups_survive
      ),
    wt_gain = gd18_weight - gd0_weight,
    group = str_to_lower(group)
    ),
  wt_gain
  )

litters_df_clean
```

Use pipes `|>` to avoid all these above:
```{r}
litters_df = 
  read_csv("./data_import_examples/FAS_litters.csv", na = c("NA", ".", "")) |> 
  janitor::clean_names() |> 
  select(-pups_survive) |> 
  mutate(
    wt_gain = gd18_weight - gd0_weight,
    group = str_to_lower(group)) |> 
  drop_na(wt_gain)

litters_df
```

Learning Assessment Code:
```{r}
pups_df=
  read_csv("./data_import_examples/FAS_pups.csv", na = c("NA", "."), skip = 3) |>
  janitor::clean_names() |>
  filter(sex == 1) |>
  select(-pd_ears) |> 
  mutate(pd_pivot_gt7 = pd_pivot > 7)

pups_df
```

Some cases where what you’re piping isn’t going into the first argument. Here, using the placeholder `_` is necessary to indicate where the object being piped should go:
```{r}
litters_df |>
  lm(wt_gain ~ pups_born_alive, data = _) |>
  broom::tidy()
```


